{
    "$schema": "./node_modules/nx/schemas/nx-schema.json",
    "defaultBase": "main",
    "extends": "nx/presets/npm.json",
    "namedInputs": {
        "default": ["{projectRoot}/**/*", "sharedGlobals"],
        "docker": ["{projectRoot}/Dockerfile", "{projectRoot}/.dockerignore", "production"],
        "dotnetShared": [
            "{workspaceRoot}/.editorconfig",
            "{workspaceRoot}/global.json",
            "{workspaceRoot}/Directory.Build.props",
            "{workspaceRoot}/Directory.Build.targets",
            "{workspaceRoot}/Directory.Packages.props",
            "{workspaceRoot}/NuGet.config",
            "{workspaceRoot}/apps/cs-analyzer/**/*.cs",
            "{workspaceRoot}/apps/cs-analyzer/**/*.csproj",
            { "runtime": "dotnet --version" }
        ],
        "dotnetSources": [
            "{projectRoot}/**/*.cs",
            "{projectRoot}/**/*.csproj",
            "{projectRoot}/**/*.fsproj",
            "{projectRoot}/**/*.vbproj",
            "{projectRoot}/**/*.props",
            "{projectRoot}/**/*.targets",
            "{projectRoot}/**/*.json",
            "{projectRoot}/**/*.config",
            "dotnetShared"
        ],
        "infrastructure": [
            "{workspaceRoot}/infrastructure/**/*.yaml",
            "{workspaceRoot}/.github/workflows/*.yml",
            "{workspaceRoot}/apps/*/Dockerfile"
        ],
        "lint": [
            "{projectRoot}/**/*.ts",
            "{projectRoot}/**/*.tsx",
            "{projectRoot}/**/*.js",
            "{projectRoot}/**/*.jsx",
            "{projectRoot}/**/*.json",
            "{workspaceRoot}/biome.json"
        ],
        "production": [
            "default",
            "!{projectRoot}/**/?(*.)+(spec|test).[jt]s?(x)?(.snap)",
            "!{projectRoot}/tsconfig.spec.json",
            "!{projectRoot}/**/*.tsbuildinfo"
        ],
        "python": [
            "{workspaceRoot}/**/*.py",
            "{workspaceRoot}/pyproject.toml",
            "!{workspaceRoot}/.claude/**",
            "!{workspaceRoot}/.cache/**",
            "!{workspaceRoot}/.git/**",
            "!{workspaceRoot}/.nx/**",
            "!{workspaceRoot}/.venv/**",
            "!{workspaceRoot}/_TMP/**",
            "!{workspaceRoot}/coverage/**",
            "!{workspaceRoot}/dist/**",
            "!{workspaceRoot}/node_modules/**",
            "!{workspaceRoot}/test-results/**"
        ],
        "sharedGlobals": [
            "{workspaceRoot}/nx.json",
            "{workspaceRoot}/tsconfig.base.json",
            "{workspaceRoot}/vitest.config.ts",
            "{workspaceRoot}/playwright.config.ts",
            "{workspaceRoot}/biome.json",
            "{workspaceRoot}/package.json",
            "{workspaceRoot}/pnpm-lock.yaml",
            "{workspaceRoot}/pnpm-workspace.yaml",
            { "runtime": "node --version" }
        ],
        "testing": [
            "{projectRoot}/src/**/*",
            "{projectRoot}/tests/**/*",
            "{projectRoot}/**/?(*.)+(spec|test).[jt]s?(x)",
            "{workspaceRoot}/vitest.config.ts",
            "{workspaceRoot}/vite.config.ts",
            "{workspaceRoot}/vite.factory.ts",
            "sharedGlobals"
        ],
        "typescript": [
            "{projectRoot}/**/*.ts",
            "{projectRoot}/**/*.tsx",
            "{projectRoot}/tsconfig*.json",
            "sharedGlobals"
        ]
    },
    "parallel": 4,
    "plugins": [
        {
            "exclude": ["tools/**/*", "**/node_modules/**", "**/dist/**"],
            "include": ["apps/*/vite.config.ts", "packages/*/vite.config.ts"],
            "options": {
                "buildTargetName": "build",
                "previewTargetName": "preview",
                "serveStaticTargetName": "serve-static",
                "serveTargetName": "dev"
            },
            "plugin": "@nx/vite/plugin"
        },
        {
            "exclude": ["tools/**/*", "**/node_modules/**", "**/dist/**"],
            "include": ["apps/*/vite.config.ts", "packages/*/vite.config.ts"],
            "options": { "testMode": "run", "testTargetName": "test" },
            "plugin": "@nx/vitest"
        },
        {
            "exclude": ["tools/**/*", "**/node_modules/**", "**/dist/**"],
            "include": ["apps/*/Dockerfile"],
            "options": { "buildTargetName": "docker:build", "defaultPlatform": "linux/amd64" },
            "plugin": "@nx/docker"
        },
        {
            "exclude": ["tools/**/*", "**/node_modules/**", "**/dist/**", "**/bin/**", "**/obj/**"],
            "include": ["**/*.csproj", "**/*.fsproj", "**/*.vbproj"],
            "plugin": "@nx/dotnet"
        },
        {
            "options": { "packageManager": "uv" },
            "plugin": "@nxlv/python"
        },
        {
            "include": ["playwright.config.ts"],
            "options": { "targetName": "e2e" },
            "plugin": "@nx/playwright/plugin"
        },
        {
            "include": ["apps/*/Dockerfile"],
            "options": { "defaultEngine": "docker", "defaultRegistry": "docker.io" },
            "plugin": "@nx-tools/nx-container"
        },
        {
            "options": { "targetName": "check" },
            "plugin": "@berenddeboer/nx-biome"
        }
    ],
    "pluginsConfig": { "@nx/js": { "projectsAffectedByDependencyUpdates": "auto" } },
    "release": {
        "changelog": {
            "projectChangelogs": false,
            "workspaceChangelog": {
                "createRelease": "github",
                "file": "./CHANGELOG.md",
                "renderOptions": { "applyUsernameToAuthors": true, "authors": true, "commitReferences": true, "versionTitleDate": true }
            }
        },
        "conventionalCommits": {
            "parserOpts": {
                "headerCorrespondence": ["type", "scope", "subject"],
                "headerPattern": "^\\[?([A-Za-z]+)!?\\]?!?(?:\\(([^)]*)\\))?:\\s*(.+)$"
            },
            "types": {
                "build": { "changelog": false },
                "chore": { "changelog": false },
                "ci": { "changelog": false },
                "docs": { "changelog": { "title": "[DOCUMENTATION]" }, "semverBump": "none" },
                "feat": { "changelog": { "title": "[FEATURES]" }, "semverBump": "minor" },
                "fix": { "changelog": { "title": "[BUG_FIXES]" }, "semverBump": "patch" },
                "perf": { "changelog": { "title": "[PERFORMANCE]" }, "semverBump": "patch" },
                "refactor": { "changelog": { "title": "[REFACTORING]" }, "semverBump": "patch" },
                "style": { "changelog": false },
                "test": { "changelog": false }
            }
        },
        "git": { "commit": true, "commitMessage": "chore(release): {version}", "tag": true },
        "projects": ["packages/*"],
        "version": { "conventionalCommits": true, "fallbackCurrentVersionResolver": "disk" }
    },
    "sync": { "disabledTaskSyncGenerators": ["@nx/js:typescript-sync"] },
    "targetDefaults": {
        "analyze": {
            "cache": false,
            "continuous": true,
            "dependsOn": ["build"],
            "executor": "nx:run-commands",
            "options": { "command": "pnpm exec serve .vite -l 8080" }
        },
        "build": {
            "dependsOn": ["^build"],
            "inputs": ["production", "^production", "{workspaceRoot}/vite.factory.ts"],
            "outputs": ["{projectRoot}/dist/**/*.js", "{projectRoot}/dist/**/*.d.ts", "{projectRoot}/dist/**/*.map"]
        },
        "check": { "cache": true, "inputs": ["lint", "sharedGlobals"] },
        "dev": {
            "cache": false,
            "configurations": {
                "debug": {
                    "env": {
                        "VITE_DEVTOOLS_CONSOLE": "true",
                        "VITE_DEVTOOLS_EXPERIMENTAL": "true",
                        "VITE_DEVTOOLS_LOG_LEVEL": "Debug",
                        "VITE_DEVTOOLS_PERFORMANCE": "true"
                    }
                },
                "minimal": {
                    "env": {
                        "VITE_DEVTOOLS_CONSOLE": "false",
                        "VITE_DEVTOOLS_EXPERIMENTAL": "false",
                        "VITE_DEVTOOLS_LOG_LEVEL": "Warning",
                        "VITE_DEVTOOLS_PERFORMANCE": "false"
                    }
                },
                "production": {
                    "env": {
                        "VITE_DEVTOOLS_CONSOLE": "false",
                        "VITE_DEVTOOLS_EXPERIMENTAL": "false",
                        "VITE_DEVTOOLS_LOG_LEVEL": "Error",
                        "VITE_DEVTOOLS_PERFORMANCE": "false"
                    }
                }
            },
            "continuous": true
        },
        "docker:build": { "dependsOn": ["build"], "inputs": ["docker"] },
        "hadolint": {
            "cache": true,
            "executor": "nx:run-commands",
            "inputs": ["docker"],
            "options": { "command": "hadolint Dockerfile", "cwd": "{projectRoot}" }
        },
        "inspect:build": {
            "cache": false,
            "dependsOn": ["build"],
            "executor": "nx:run-commands",
            "options": { "command": "pnpm exec serve .vite-inspect -l 8081" }
        },
        "inspect:dev": {
            "cache": false,
            "executor": "nx:run-commands",
            "options": { "command": "echo 'Open http://localhost:5173/__inspect/ in browser' && pnpm exec nx dev" }
        },
        "k8s:diff": {
            "cache": false,
            "executor": "nx:run-commands",
            "options": {
                "command": "for dir in infrastructure/projects/*/overlays/prod; do [[ \"$dir\" == *\"_template\"* ]] && continue; echo \"[INFO] Diff for $(basename $(dirname $(dirname \"$dir\")))...\"; kubectl diff -k \"$dir\" || true; done",
                "cwd": "{workspaceRoot}"
            }
        },
        "pwa:icons": {
            "cache": false,
            "executor": "nx:run-commands",
            "options": { "command": "tsx --no-warnings tools/scripts/generate-pwa-icons.ts", "cwd": "{projectRoot}" }
        },
        "pwa:icons:watch": {
            "cache": false,
            "executor": "nx:run-commands",
            "options": { "command": "tsx watch tools/scripts/generate-pwa-icons.ts", "cwd": "{projectRoot}" }
        },
        "test": { "inputs": ["testing", "^production"], "outputs": ["{projectRoot}/coverage", "{workspaceRoot}/test-results"] },
        "test:mutate": { "cache": true, "inputs": ["testing", "^production"], "outputs": ["{workspaceRoot}/test-results/mutation"] },
        "test:ui": {
            "cache": false,
            "executor": "nx:run-commands",
            "options": { "command": "vitest --ui", "cwd": "{workspaceRoot}" }
        },
        "typecheck": {
            "cache": true,
            "dependsOn": ["^typecheck"],
            "inputs": ["typescript", "sharedGlobals"]
        }
    },
    "useInferencePlugins": true,
    "workspaceLayout": { "appsDir": "apps", "libsDir": "packages" }
}
