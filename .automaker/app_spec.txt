<project_specification>
  <project_name>Parametric Portal</project_name>

  <overview>
    Multi-application platform built as Nx monorepo. Provides universal infrastructure
    (packages/) enabling rapid development of multiple independent apps (apps/). Goal:
    80-90% of requirements pre-built—auth, database, API, components, theming, telemetry—
    so new apps are composition, not implementation.
  </overview>

  <architecture>
    <principle>packages/ = universal infrastructure (app-agnostic)</principle>
    <principle>apps/ = individual applications (compose from packages/)</principle>
    <principle>All design decisions support multi-app scenarios, never single-app</principle>
  </architecture>

  <technology_stack>
    <technology>Nx monorepo, pnpm workspaces, TypeScript 6.0-dev strict</technology>
    <technology>Effect 3.19 (FP core, error handling, schemas, runtime)</technology>
    <technology>React 19 canary, React Aria Components, Vite 7</technology>
    <technology>Drizzle ORM, PostgreSQL, @effect/platform-node</technology>
    <technology>Tailwind v4, LightningCSS, Biome, Vitest</technology>
    <technology>Catalog-managed deps via pnpm-workspace.yaml</technology>
  </technology_stack>

  <packages_infrastructure>
    <package name="components-next">Universal React components with built-in tooltips, gestures, async state handling</package>
    <package name="server">HTTP middleware, API contracts, error handling for multi-app backend</package>
    <package name="database">Drizzle client, repositories, migrations supporting multi-app isolation</package>
    <package name="types">Branded primitives, schemas, cross-app type definitions</package>
    <package name="theme">OKLCH color system, runtime theming, Tailwind integration</package>
    <package name="runtime">React-Effect bridge, universal state management patterns</package>
    <package name="ai">Effect-based AI service integrations (Anthropic, OpenAI)</package>
  </packages_infrastructure>

  <core_capabilities>
    <capability>Universal component library with async-aware rendering via Slot.bind</capability>
    <capability>Multi-app HTTP API with Effect-based middleware and routing</capability>
    <capability>Type-safe database layer with repositories and multi-app support</capability>
    <capability>Cross-app authentication, authorization, and session management</capability>
    <capability>Runtime theme system with OKLCH colors and data-* attributes</capability>
    <capability>Telemetry and metrics infrastructure (app-scoped, cross-app aggregation)</capability>
  </core_capabilities>

  <development_guidelines>
    <guideline>MULTI-APP FIRST: packages/ code is infrastructure for many apps, never app-specific logic</guideline>
    <guideline>EFFECT-FIRST: Effect.pipe, Match, Option over imperative if/else/try-catch</guideline>
    <guideline>ALGORITHMIC: Derive values from frozen B constant per file, zero hardcoded literals</guideline>
    <guideline>USE INFRASTRUCTURE: Search packages/ before creating utilities—no duplication</guideline>
    <guideline>BRANDED TYPES: Use @parametric-portal/types (DurationMs, Timestamp, UserId, etc.)</guideline>
    <guideline>COMPOUND PATTERNS: Object.assign(Root, {{ Item, Section }}) for component composition</guideline>
    <guideline>ONE-LINE USAGE: Common cases require single JSX line, composition only for advanced</guideline>
    <guideline>DATA ATTRIBUTES: Use data-slot, data-color, data-size, data-async-state for styling</guideline>
    <guideline>QUALITY: Sub-3-min builds (Nx cache), 80% coverage, typecheck + check before completion</guideline>
  </development_guidelines>

  <anti_patterns>
    <item>Hardcoding app-specific logic in packages/ (breaks universal infrastructure)</item>
    <item>Designing server/database/API for single app (limits multi-app scaling)</item>
    <item>Hand-rolled types—derive from RAC: Omit&lt;RACXProps, 'children'&gt; &amp; {{}}</item>
    <item>Deep nesting (4+ levels) or nested ternaries—use Match/dispatch tables</item>
    <item>Manual null checks—use Option.fromNullable().pipe()</item>
    <item>Duplicating utilities from packages/ or external libs (RAC, Effect)</item>
    <item>Type-only props—every prop must affect rendered output</item>
  </anti_patterns>

  <reference_implementation>
    <file>packages/components-next/src/actions/button.tsx</file>
    <description>Gold standard: 168 lines, handles standard/toggle/async modes, tooltips, gestures, icons—one component, zero composition required for common cases</description>
  </reference_implementation>
</project_specification>
