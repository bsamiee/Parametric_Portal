{
    "category": "infrastructure",
    "dependencies": ["feature-multiapp-database"],
    "description": "Add RequestContext Effect service to thread app identity through requests.\n\nCurrently (after multiapp-database): `AppId` branded type exists in `packages/types/src/schema.ts`. `apps` table exists with `findBySlug` in `DatabaseService.apps`. `packages/server/src/middleware.ts:50-60` has `RequestId` Tag (string) and `Session` Tag (AuthContext). No app identity threading exists. Telemetry/metrics cannot distinguish originating app.\n\nDeliverables:\n1. Create `packages/server/src/context.ts` with `RequestContext` class extending `Effect.Service`\n2. RequestContext shape: `{ appId: AppId; userId: UserId | null; sessionId: SessionId | null; requestId: string }`\n3. Add `requestContext()` middleware in `packages/server/src/middleware.ts` that:\n   - Extracts `X-App-Id` header (slug string)\n   - Calls `DatabaseService.apps.findBySlug(slug)` to validate app exists\n   - Provides `RequestContext` with resolved `appId`\n4. Update `packages/server/src/telemetry.ts`: add `app` attribute to spans from `RequestContext.appId`\n5. Update `packages/server/src/metrics.ts`: add `app` label to metrics from `RequestContext.appId`\n\nAcceptance: `pnpm exec nx run server:typecheck` passes. Request without valid `X-App-Id` header returns 400. Request with invalid app slug returns 404.",
    "descriptionHistory": [],
    "id": "feature-multiapp-context",
    "status": "backlog",
    "title": "RequestContext service layer"
}
