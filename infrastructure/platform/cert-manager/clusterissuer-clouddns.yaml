# --- LETSENCRYPT CLUSTERISSUER (GOOGLE CLOUD DNS) ----------------------------
# DNS-01 challenge solver for wildcard and custom domain certificates
# Requires: GCP service account with dns.admin role
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
  labels:
    app.kubernetes.io/name: letsencrypt
    app.kubernetes.io/component: tls
    app.kubernetes.io/part-of: platform
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: ${LETSENCRYPT_EMAIL}  # REPLACE: admin email for cert notifications
    privateKeySecretRef:
      name: letsencrypt-prod-key

    solvers:
      - dns01:
          cloudDNS:
            project: ${GCP_PROJECT_ID}  # REPLACE: GCP project ID
            serviceAccountSecretRef:
              name: clouddns-sa-secret
              key: key.json
---
# --- LETSENCRYPT STAGING (FOR TESTING) ---------------------------------------
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-staging
  labels:
    app.kubernetes.io/name: letsencrypt
    app.kubernetes.io/component: tls
    app.kubernetes.io/part-of: platform
spec:
  acme:
    server: https://acme-staging-v02.api.letsencrypt.org/directory
    email: ${LETSENCRYPT_EMAIL}  # REPLACE: admin email
    privateKeySecretRef:
      name: letsencrypt-staging-key

    solvers:
      - dns01:
          cloudDNS:
            project: ${GCP_PROJECT_ID}  # REPLACE: GCP project ID
            serviceAccountSecretRef:
              name: clouddns-sa-secret
              key: key.json
