name: Issue Commands

on:
    issues:
        types: [opened]
    issue_comment:
        types: [created, edited]

permissions:
    contents: read
    issues: write
    pull-requests: write

concurrency:
    group: issue-commands-${{ github.event.issue.number || github.event.comment.issue.number }}
    cancel-in-progress: false

jobs:
    # --- Welcome first-time contributors -------------------------------------
    welcome:
        name: Welcome First-Time Contributor
        if: github.event_name == 'issues' && github.event.action == 'opened'
        runs-on: ubuntu-latest
        timeout-minutes: 2
        steps:
            - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
              with:
                  sparse-checkout: |
                      .github/actions/issue-ops
                      .github/scripts/schema.ts
                  sparse-checkout-cone-mode: false

            - uses: ./.github/actions/issue-ops
              with:
                  operation: welcome
                  body: |
                      Thanks for opening your first issue, @${{ github.event.issue.user.login }}! ðŸŽ‰

                      We appreciate your contribution and will review it soon.
                  emoji: '+1,rocket'

    # --- Handle duplicate marking command ------------------------------------
    duplicate-detection:
        name: Mark Duplicate
        if: github.event_name == 'issue_comment' && (github.event.action == 'created' || github.event.action == 'edited')
        runs-on: ubuntu-latest
        timeout-minutes: 2
        steps:
            - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
              with:
                  sparse-checkout: |
                      .github/actions/issue-ops
                      .github/scripts/schema.ts
                  sparse-checkout-cone-mode: false

            - uses: ./.github/actions/issue-ops
              with:
                  operation: mark-duplicate
                  duplicate-command: '/duplicate'
                  labels: duplicate
                  close-issue: true
                  require-permission: write
                  emoji: 'eyes'
