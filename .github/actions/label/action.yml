name: Label Handler
description: Executes label-triggered behaviors (pin, unpin, comment) via schema-driven dispatch

inputs:
    action:
        description: 'Label event: labeled or unlabeled'
        required: true
    label:
        description: 'Label name that triggered the event'
        required: true
    node_id:
        description: 'Issue/PR node_id for GraphQL mutations'
        required: true
    number:
        description: 'Issue/PR number'
        required: true

outputs:
    executed:
        description: 'Whether a behavior was executed'
        value: ${{ steps.run.outputs.executed }}
    behavior:
        description: 'Behavior that was executed (pin, unpin, comment, or null)'
        value: ${{ steps.run.outputs.behavior }}

runs:
    using: composite
    steps:
        - name: Checkout
          uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0
          with:
              sparse-checkout: .github/scripts
              sparse-checkout-cone-mode: false

        - uses: ./.github/actions/node-env

        - name: Execute Label Behavior
          id: run
          uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8
          env:
              NODE_OPTIONS: --import tsx
          with:
              script: |
                  const { behavior } = await import('${{ github.workspace }}/.github/scripts/label.ts');
                  const result = await behavior({
                      context: { repo: context.repo, payload: context.payload },
                      core,
                      github,
                      spec: {
                          action: '${{ inputs.action }}',
                          label: '${{ inputs.label }}',
                          nodeId: '${{ inputs.node_id }}',
                          number: parseInt('${{ inputs.number }}'),
                      },
                  });
                  core.setOutput('executed', result.executed);
                  core.setOutput('behavior', result.behavior ?? 'null');
