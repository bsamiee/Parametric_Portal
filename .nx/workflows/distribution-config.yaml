# Dynamic Agents Configuration
# Nx Cloud uses PR-size-based agent allocation for cost efficiency
# See: https://nx.dev/docs/features/ci-features/dynamic-agents
# See: https://nx.dev/docs/guides/nx-cloud/optimize-your-ttg

distribute-on:
    # Small PRs (1-33% of projects affected): 2 agents for quick feedback
    small-changeset: 2 linux-medium-js

    # Medium PRs (34-66% of projects affected): 3 agents (balanced)
    medium-changeset: 3 linux-medium-js

    # Large PRs (67-100% of projects affected): 4 agents for speed
    large-changeset: 4 linux-medium-js

# Retry flaky tasks automatically to keep pipelines green
# See: https://nx.dev/docs/features/ci-features/flaky-tasks
# Flaky tasks are detected when a task fails in CI but passes on retry.
# Nx Cloud tracks flaky task history and re-runs them automatically in the background.
# Analytics available at: https://cloud.nx.app/orgs/workspace/{nxCloudId}/analytics
flaky-tasks:
    # Enable automatic retry of flaky tasks
    enabled: true
    # Maximum number of retry attempts for flaky tasks (range: 1-3 recommended)
    max-retries: 2
